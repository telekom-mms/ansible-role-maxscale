# Generated by Ansible

[maxscale]
threads=auto
admin_host={{ maxscale_admin_host }}
admin_port={{ maxscale_admin_port }}
admin_secure_gui={{ maxscale_admin_secure_gui|default("true")}}


## the following parts are controlled via the type
## ultimately it could be dampened down to one jinja block with a whole lot of ifs and fors

{% for server in maxscale_config_server_list %}
[{{ server.name }}]
type=server
address={{ server.address }}
port={{ server.port }}
protocol={{ server.protocol|default("MariaDBBackend") }}

{% endfor %}

{% for maxscale_monitor in maxscale_config_monitor_list %}
[{{ maxscale_monitor.name }}]
type=monitor
module={{ maxscale_monitor.module }}
servers={{ maxscale_monitor.servers }}
user={{ maxscale_database_monitor_user_name }}
password={{ maxscale_database_monitor_user_password }}
monitor_interval={{ maxscale_monitor.monitor_interval|default("2000ms") }}
{% endfor %}

{% for maxscale_service in maxscale_config_service_list %}
[{{ maxscale_service.name }}]
type=service
router={{ maxscale_service.router }}
servers={{ maxscale_service.servers }}
user={{ maxscale_database_user_name }}
password={{ maxscale_database_user_password }}
use_sql_variables_in={{ maxscale_config_use_sql_variables_in|default("all") }}
{% if maxscale_config_filter_list is defined %}}
filters={{ maxscale_config_filter_list.name|join(',') }}
{% endfor %}

{% for maxscale_listener in maxscale_config_listener_list %}
[{{ maxscale_listener.name }}]
type=listener
service={{ maxscale_listener.service }}
protocol={{ maxscale_listener.protocol|default("MariaDBClient") }}
port={{ maxscale_listener.port }}
address={{ maxscale_listener.address }}
{% endfor %}

{% for maxscale_filter in maxscale_config_filter_list %}
[{{ maxscale_filter.name }}]
type=filter
module={{ maxscale_filter.module|default("namedserverfilter") }}
{% for match in matches %}}
match{{ match.number }}={{ maxscale_filter.value }}
target{{ match.number }}={{ maxscale_filter.target|default("->master") }}
{% endfor %}
{% endfor %}
